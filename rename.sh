#!/bin/sh

filebot -script fn:amc "$2" -r --output /volume1 --conflict override --action $1 -non-strict --def "movieFormat=Movies/{n.replaceTrailingBrackets().replaceAll(': ', ' - ').replaceAll('/[\`´‘’ʻ]/', '\'').space(' ')}{' (' + y + ')'}{fn.match(/(?i)sbs/)? '.3D-SBS': ''}{'.'+vf}{'.'+source}{'.'+vc.replace('Microsoft', 'VC-1')}{audio.size() > 1? '.DL.'+audio.groupBy{ it.Codec }.collect{ c, a -> [c.replace('MPEG Audio', 'MP3')] + a*.Language }.flatten().join('.') : '.'+ac.replace('MPEG Audio', 'MP3')}{audio.size() == 1? {try{'.' + allOf{audio.language}{videos.language}.flatten().removeAll([null]).first()} catch(Exception x){'.de'}}.call() : ''}{'.' + audio.channels.sort().last().replace('8', '7.1').replace('7', '6.1').replace('6', '5.1').replace('3', '2.1').replace('2','2.0')}" "seriesFormat=Serien/{n.replaceTrailingBrackets().replaceAll(': ', ' - ').replaceAll('/[\`´‘’ʻ]/', '\'').space(' ')}{' (' + y + ')'}/{episode.special ? 'Specials' : 'Season '+s.pad(2) + {' (' + episodelist.findAll{ it.season == s }.airdate.year.min() + ')'}.call()}/{n.replaceAll(': ', ' - ').replaceAll('[\`´‘’ʻ]', '\'').space(' ')} - {episode.special ? '0x'+special.pad(2) : sxe} - {t.replaceAll('[!?,]+', '').replaceAll(': ', ' - ').replaceAll('[\`´‘’ʻ]', '\'').space(' ')}{'.'+vf}{'.'+source}{'.'+vc.replace('Microsoft', 'VC-1')}{audio.size() > 1? '.DL.'+audio.groupBy{ it.Codec }.collect{ c, a -> [c] + a*.Language }.flatten().join('.') : '.'+ac.replace('MPEG Audio', 'MP3')}{audio.size() == 1? {try{'.' + allOf{audio.language}{videos.language}.flatten().removeAll([null]).first()} catch(Exception x){'.en'}}.call() : ''}{'.' + audio.channels.sort().last().replace('8', '7.1').replace('7', '6.1').replace('6', '5.1').replace('3', '2.1').replace('2','2.0')}"
